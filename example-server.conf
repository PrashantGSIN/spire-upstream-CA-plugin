server {
    bind_address = "0.0.0.0"
    bind_port = "8081"
    trust_domain = "example.org"
    data_dir = "/opt/spire/data/server"
    log_level = "DEBUG"
    log_file = "/var/log/spire/server.log"
}

plugins {
    DataStore "sql" {
        plugin_data {
            database_type = "sqlite3"
            connection_string = "/opt/spire/data/server/datastore.sqlite3"
        }
    }

    NodeAttestor "join_token" {
        plugin_data {}
    }

    KeyManager "disk" {
        plugin_data {
            keys_path = "/opt/spire/data/server/keys.json"
        }
    }

    # External CA UpstreamAuthority Plugin Configuration
    UpstreamAuthority "external_ca" {
        plugin_cmd = "/opt/spire/plugins/spire-upstream-ca-plugin"
        plugin_checksum = "replace_with_actual_checksum_from_build"
        plugin_data {
            # CA Configuration
            ca_endpoint = "https://emea.api.hvca.globalsign.com:8443/v2"
            
            # Authentication
            api_key = "41f9a668de7d24dc"
            
            # Optional: Client certificate authentication (mTLS)
            # cert_path = "/opt/spire/conf/client-cert.pem"
            # key_path = "/opt/spire/conf/client-key.pem"
            
            # Trust bundle
            trust_bundle_path = "/opt/spire/conf/ca-roots.pem"
            
            # Security settings
            insecure = false
        }
    }

    Notifier "k8sbundle" {
        plugin_data {
            namespace = "spire"
            config_map = "spire-bundle"
        }
    }
}

health_checks {
    listener_enabled = true
    bind_address = "localhost"
    bind_port = "8080"
    live_path = "/live"
    ready_path = "/ready"
}
